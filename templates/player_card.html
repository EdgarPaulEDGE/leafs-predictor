{% extends "base.html" %}

{% block content %}
<div class="player-card-hero" style="background-image: url('{{ player.heroImage or player.headshot }}');">
    <div class="player-card-overlay"></div>
    <div class="player-card-content">
        <img src="{{ player.headshot }}" alt="{{ player.name }}" class="player-card-headshot">
        <div class="player-card-info">
            <div class="player-card-number">#{{ player.number }}</div>
            <h1 class="player-card-name">{{ player.name }}</h1>
            <div class="player-card-team">
                <img src="https://assets.nhle.com/logos/nhl/svg/{{ player.team }}_dark.svg" alt="{{ player.team }}" class="player-card-team-logo">
                {{ player.teamName }}
            </div>
            <div class="player-card-meta">
                <span>{{ player.position }}</span>
                <span>{{ player.height }}cm / {{ player.weight }}kg</span>
                <span>{{ player.shootsCatches }}</span>
            </div>
        </div>
    </div>
</div>

<div class="player-card-body">
    <!-- Radar Chart -->
    <div class="card radar-card">
        <h3>Spielerprofil</h3>
        <canvas id="radarChart" width="300" height="300"></canvas>
    </div>

    <!-- Season Stats -->
    <div class="card">
        <div class="section-header">
            <h2>Saison 2025/26</h2>
        </div>
        {% if player.position == 'G' %}
        <div class="player-stats-grid">
            <div class="player-stat-box">
                <span class="stat-val">{{ stats.gamesPlayed or 0 }}</span>
                <span class="stat-lbl">GP</span>
            </div>
            <div class="player-stat-box">
                <span class="stat-val">{{ stats.wins or 0 }}</span>
                <span class="stat-lbl">W</span>
            </div>
            <div class="player-stat-box">
                <span class="stat-val">{{ stats.losses or 0 }}</span>
                <span class="stat-lbl">L</span>
            </div>
            <div class="player-stat-box highlight">
                <span class="stat-val">{{ "%.3f"|format(stats.savePctg or 0) }}</span>
                <span class="stat-lbl">SV%</span>
            </div>
            <div class="player-stat-box highlight">
                <span class="stat-val">{{ "%.2f"|format(stats.goalsAgainstAvg or 0) }}</span>
                <span class="stat-lbl">GAA</span>
            </div>
            <div class="player-stat-box">
                <span class="stat-val">{{ stats.shutouts or 0 }}</span>
                <span class="stat-lbl">SO</span>
            </div>
        </div>
        {% else %}
        <div class="player-stats-grid">
            <div class="player-stat-box">
                <span class="stat-val">{{ stats.gamesPlayed or 0 }}</span>
                <span class="stat-lbl">GP</span>
            </div>
            <div class="player-stat-box highlight">
                <span class="stat-val">{{ stats.goals or 0 }}</span>
                <span class="stat-lbl">G</span>
            </div>
            <div class="player-stat-box highlight">
                <span class="stat-val">{{ stats.assists or 0 }}</span>
                <span class="stat-lbl">A</span>
            </div>
            <div class="player-stat-box highlight big">
                <span class="stat-val">{{ stats.points or 0 }}</span>
                <span class="stat-lbl">PTS</span>
            </div>
            <div class="player-stat-box">
                <span class="stat-val {{ 'positive' if (stats.plusMinus or 0) > 0 else 'negative' if (stats.plusMinus or 0) < 0 }}">{{ '%+d'|format(stats.plusMinus or 0) }}</span>
                <span class="stat-lbl">+/-</span>
            </div>
            <div class="player-stat-box">
                <span class="stat-val">{{ stats.pim or 0 }}</span>
                <span class="stat-lbl">PIM</span>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Bio -->
    <div class="card">
        <div class="section-header"><h2>Bio</h2></div>
        <div class="player-bio-grid">
            <div class="bio-item">
                <span class="bio-label">Geburtstag</span>
                <span class="bio-value">{{ player.birthDate }}</span>
            </div>
            <div class="bio-item">
                <span class="bio-label">Geburtsort</span>
                <span class="bio-value">{{ player.birthCity }}, {{ player.birthCountry }}</span>
            </div>
            {% if player.draftYear %}
            <div class="bio-item">
                <span class="bio-label">Draft</span>
                <span class="bio-value">{{ player.draftYear }} Runde {{ player.draftRound }}, Pick {{ player.draftPick }}</span>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Last 5 Games -->
    {% if last5 %}
    <div class="card">
        <div class="section-header"><h2>Letzte 5 Spiele</h2></div>
        <div class="last5-grid">
            {% for g in last5 %}
            <div class="last5-game">
                <span class="last5-opp">
                    <img src="https://assets.nhle.com/logos/nhl/svg/{{ g.opponentAbbrev }}_dark.svg" alt="" class="team-logo-xs">
                    {{ g.opponentAbbrev }}
                </span>
                {% if player.position == 'G' %}
                <span class="last5-stat">{{ g.decision or '-' }}</span>
                <span class="last5-detail">{{ "%.3f"|format(g.savePctg or 0) }} SV%</span>
                {% else %}
                <span class="last5-stat">{{ g.goals or 0 }}G {{ g.assists or 0 }}A</span>
                <span class="last5-detail">{{ g.points or 0 }}P</span>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Career Stats -->
    {% if career %}
    <div class="card">
        <div class="section-header"><h2>Karriere</h2></div>
        {% if player.position == 'G' %}
        <div class="player-stats-grid small">
            <div class="player-stat-box"><span class="stat-val">{{ career.gamesPlayed or 0 }}</span><span class="stat-lbl">GP</span></div>
            <div class="player-stat-box"><span class="stat-val">{{ career.wins or 0 }}</span><span class="stat-lbl">W</span></div>
            <div class="player-stat-box"><span class="stat-val">{{ "%.3f"|format(career.savePctg or 0) }}</span><span class="stat-lbl">SV%</span></div>
            <div class="player-stat-box"><span class="stat-val">{{ career.shutouts or 0 }}</span><span class="stat-lbl">SO</span></div>
        </div>
        {% else %}
        <div class="player-stats-grid small">
            <div class="player-stat-box"><span class="stat-val">{{ career.gamesPlayed or 0 }}</span><span class="stat-lbl">GP</span></div>
            <div class="player-stat-box"><span class="stat-val">{{ career.goals or 0 }}</span><span class="stat-lbl">G</span></div>
            <div class="player-stat-box"><span class="stat-val">{{ career.assists or 0 }}</span><span class="stat-lbl">A</span></div>
            <div class="player-stat-box"><span class="stat-val">{{ career.points or 0 }}</span><span class="stat-lbl">PTS</span></div>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
<script>
var radarLabels = {{ radar.labels|tojson }};
var radarValues = {{ radar.values|tojson }};

new Chart(document.getElementById('radarChart'), {
    type: 'radar',
    data: {
        labels: radarLabels,
        datasets: [{
            label: '{{ player.name }}',
            data: radarValues,
            backgroundColor: 'rgba(0, 229, 255, 0.2)',
            borderColor: '#00e5ff',
            borderWidth: 2,
            pointBackgroundColor: '#00e5ff',
            pointRadius: 4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
            r: {
                beginAtZero: true,
                max: 100,
                ticks: { display: false },
                grid: { color: 'rgba(255,255,255,0.1)' },
                angleLines: { color: 'rgba(255,255,255,0.1)' },
                pointLabels: { color: '#e8f0ff', font: { size: 11 } }
            }
        },
        plugins: {
            legend: { display: false }
        }
    }
});
</script>
{% endblock %}
