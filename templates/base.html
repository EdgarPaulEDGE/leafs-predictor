<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDGE NHL</title>
    <style>
    :root{--leafs-blue:#0a1628;--bg-dark:#050810;--bg-surface:#0a0f1c;--bg-card:rgba(10,15,28,.85);--text-primary:#e8f0ff;--text-secondary:rgba(232,240,255,.65);--cyan:#00e5ff;--green:#00e676;--red:#ff5252;--radius:20px;--radius-md:14px}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Inter,-apple-system,sans-serif;background:#050810;color:#e8f0ff;min-height:100vh}
    nav{background:rgba(10,22,40,.95);padding:.6rem 1.5rem;position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(0,229,255,.1)}
    .logo{font-weight:800;font-size:1.3rem;color:#e8f0ff;text-decoration:none;display:flex;align-items:center;gap:.5rem}
    .logo-img{height:32px;width:32px}
    .container{max-width:1200px;margin:0 auto;padding:1.5rem}
    .nav-menu{display:flex;list-style:none;gap:.5rem;align-items:center}
    .nav-menu>li>a{padding:.5rem 1rem;color:var(--text-secondary);text-decoration:none;border-radius:8px;font-size:.9rem}
    .nav-menu>li>a:hover,.nav-menu>li>a.active{color:#fff;background:rgba(0,229,255,.1)}
    /* Dropdown - !important to override style.min.css */
    .nav-dropdown{position:relative}
    .nav-dropdown-btn{padding:.5rem 1rem;color:var(--text-secondary);background:none;border:none;border-radius:8px;font-size:.9rem;cursor:pointer;font-family:inherit}
    .nav-dropdown-btn:hover,.nav-dropdown-btn.active{color:#fff;background:rgba(0,229,255,.1)}
    .nav-dropdown-content{display:none !important;position:absolute;top:100%;left:0;background:rgba(10,22,40,.98);border:1px solid rgba(0,229,255,.15);border-radius:12px;min-width:200px;padding:.5rem;z-index:9999;margin-top:4px}
    .nav-dropdown.open .nav-dropdown-content{display:block !important}
    .nav-dropdown-content a{display:block !important;padding:.6rem 1rem;color:var(--text-secondary);text-decoration:none;border-radius:8px;font-size:.85rem}
    .nav-dropdown-content a:hover{background:rgba(0,229,255,.1);color:#fff}
    .dropdown-divider{height:1px;background:rgba(255,255,255,.1);margin:.4rem 0}
    .nav-user{display:flex;align-items:center;gap:.75rem}
    .user-badge{background:rgba(0,229,255,.15);padding:.4rem .8rem;border-radius:8px;font-size:.85rem;font-weight:600;color:var(--cyan)}
    .theme-toggle{background:none;border:none;font-size:1.2rem;cursor:pointer;padding:.3rem}
    .logout-btn,.login-btn{color:var(--text-secondary);text-decoration:none;font-size:.85rem}
    footer{text-align:center;padding:2rem;color:var(--text-secondary);font-size:.85rem;border-top:1px solid rgba(255,255,255,.06);margin-top:2rem}
    .flash{padding:1rem;border-radius:var(--radius-md);margin-bottom:1rem}
    .flash-success{background:rgba(0,230,118,.15);border:1px solid rgba(0,230,118,.3);color:#00e676}
    .flash-error{background:rgba(255,82,82,.15);border:1px solid rgba(255,82,82,.3);color:#ff5252}
    .nav-toggle{display:none}
    @media(max-width:900px){
        .nav-menu,.nav-user{display:none}
        .nav-toggle{display:flex;flex-direction:column;gap:4px;background:none;border:none;cursor:pointer;padding:.5rem}
        .nav-toggle span{display:block;width:22px;height:2px;background:#e8f0ff;border-radius:2px}
        nav.open .nav-menu{display:flex;flex-direction:column;position:absolute;top:100%;left:0;right:0;background:rgba(10,22,40,.98);padding:1rem}
        nav.open .nav-user{display:flex;position:absolute;top:100%;right:1rem;padding:1rem 0}
    }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.min.css') }}" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="{{ url_for('static', filename='style.min.css') }}"></noscript>
    <link rel="icon" href="{{ url_for('static', filename='edge-logo.svg') }}" type="image/svg+xml">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#050810">
    <link rel="preconnect" href="https://assets.nhle.com" crossorigin>
</head>
<body>
    <script>
    // Dropdown toggle function - MUST be before nav
    function toggleDropdown(btn) {
        var dropdown = btn.parentElement;
        var isOpen = dropdown.classList.contains('open');
        // Close all dropdowns first
        document.querySelectorAll('.nav-dropdown').forEach(function(d) {
            d.classList.remove('open');
        });
        // Open this one if it was closed
        if (!isOpen) {
            dropdown.classList.add('open');
        }
    }
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.nav-dropdown')) {
            document.querySelectorAll('.nav-dropdown').forEach(function(d) {
                d.classList.remove('open');
            });
        }
    });
    </script>

    <nav>
        <a href="{{ url_for('index') }}" class="logo">
            <img src="{{ url_for('static', filename='edge-logo.svg') }}" alt="EDGE" class="logo-img" width="32" height="32">
            EDGE <span>NHL</span>
        </a>

        <button class="nav-toggle" onclick="this.closest('nav').classList.toggle('open')" aria-label="Menu">
            <span></span><span></span><span></span>
        </button>

        <ul class="nav-menu">
            <li><a href="{{ url_for('index') }}" class="{{ 'active' if active_page == 'index' }}">Home</a></li>

            <li class="nav-dropdown">
                <button type="button" class="nav-dropdown-btn" onclick="toggleDropdown(this)">Meine Tipps ▾</button>
                <div class="nav-dropdown-content">
                    <a href="{{ url_for('results') }}">Ergebnisse</a>
                    <a href="{{ url_for('leaderboard') }}">Leaderboard</a>
                </div>
            </li>

            <li class="nav-dropdown">
                <button type="button" class="nav-dropdown-btn" onclick="toggleDropdown(this)">NHL ▾</button>
                <div class="nav-dropdown-content">
                    <a href="{{ url_for('standings') }}">Standings</a>
                    <a href="{{ url_for('leaders') }}">Leaders</a>
                    <a href="{{ url_for('power_rankings') }}">Power Rankings</a>
                    <a href="{{ url_for('scoreboard') }}">Stats</a>
                    <a href="{{ url_for('news') }}">News</a>
                    <a href="{{ url_for('nhl_history') }}">History</a>
                    <div class="dropdown-divider"></div>
                    <a href="{{ url_for('injuries') }}">Injuries</a>
                    <a href="{{ url_for('line_combinations') }}">Line Combos</a>
                    <a href="{{ url_for('goalie_matchups') }}">Goalie Matchups</a>
                    <a href="{{ url_for('contracts') }}">Contracts</a>
                    <a href="{{ url_for('prospect_rankings') }}">Prospects</a>
                    <div class="dropdown-divider"></div>
                    <a href="{{ url_for('playoffs') }}">Playoffs</a>
                    <a href="{{ url_for('trades') }}">Trades</a>
                    <a href="{{ url_for('salary') }}">Salary Cap</a>
                </div>
            </li>

            <li class="nav-dropdown">
                <button type="button" class="nav-dropdown-btn" onclick="toggleDropdown(this)">Tools ▾</button>
                <div class="nav-dropdown-content">
                    <a href="{{ url_for('compare') }}">Player Compare</a>
                    <a href="{{ url_for('head_to_head') }}">Head-to-Head</a>
                    <a href="{{ url_for('calendar') }}">Kalender</a>
                    <div class="dropdown-divider"></div>
                    <a href="{{ url_for('playoff_bracket') }}">Playoff Bracket</a>
                    <a href="{{ url_for('trade_analyzer') }}">Trade Analyzer</a>
                    <a href="{{ url_for('draft_lottery') }}">Draft Lottery</a>
                    <a href="{{ url_for('season_simulator') }}">Season Simulator</a>
                </div>
            </li>
        </ul>

        <div class="nav-user">
            <button class="theme-toggle" onclick="document.body.classList.toggle('light-mode')" title="Theme">☀️</button>
            {% if g.username %}
                <span class="user-badge">{{ g.username }}</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            {% else %}
                <a href="{{ url_for('login') }}" class="login-btn">Login</a>
            {% endif %}
        </div>
    </nav>

    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash flash-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <footer>
        EDGE NHL &mdash; ML vs. Mensch &mdash; Powered by Gradient Boosting
    </footer>

    <script>
    if('serviceWorker'in navigator){navigator.serviceWorker.register('/static/sw.js').catch(function(){})}
    </script>
</body>
</html>
